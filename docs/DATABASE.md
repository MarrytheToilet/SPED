# æ•°æ®åº“ç®¡ç†æŒ‡å—

## ğŸ“– ç›®å½•

1. [æ•°æ®åº“æ¦‚è¿°](#æ•°æ®åº“æ¦‚è¿°)
2. [æ•°æ®å¯¼å…¥](#æ•°æ®å¯¼å…¥)
3. [æ•°æ®å¯¼å‡º](#æ•°æ®å¯¼å‡º)
4. [æ•°æ®æŸ¥è¯¢](#æ•°æ®æŸ¥è¯¢)
5. [æ•°æ®ç»´æŠ¤](#æ•°æ®ç»´æŠ¤)

---

## æ•°æ®åº“æ¦‚è¿°

### æ•°æ®åº“ç±»å‹

- **ç±»å‹**: SQLite
- **è·¯å¾„**: `data/artificial_joint.db`
- **ä¼˜åŠ¿**: è½»é‡çº§ã€æ— éœ€æœåŠ¡å™¨ã€æ˜“äºå¤‡ä»½

### æ•°æ®è¡¨ç»“æ„

ä¸»è¡¨: `artificial_joint_materials`

æ ¸å¿ƒå­—æ®µåˆ†ç±»ï¼š

1. **å…ƒæ•°æ®å­—æ®µ**
   - `id`: è‡ªå¢ä¸»é”®
   - `dataid`: å”¯ä¸€æ•°æ®æ ‡è¯†
   - `paper_id`: è®ºæ–‡æ ‡è¯†
   - `æ•°æ®æ ‡è¯†`: å®éªŒæè¿°

2. **åº”ç”¨ä¿¡æ¯**
   - `åº”ç”¨éƒ¨ä½`: é«‹å…³èŠ‚ã€è†å…³èŠ‚ç­‰
   
3. **çƒå¤´/è¡¬å«ä¿¡æ¯**ï¼ˆJSONæ ¼å¼ï¼‰
   - `çƒå¤´ä¿¡æ¯.çƒå¤´åŸºæœ¬ä¿¡æ¯`
   - `çƒå¤´ä¿¡æ¯.çƒå¤´-æˆåˆ†ç»„æˆ`
   - `çƒå¤´ä¿¡æ¯.çƒå¤´-è¡¨é¢å¤„ç†`
   - `å†…è¡¬/è¡¬å«ä¿¡æ¯.å†…è¡¬åŸºæœ¬ä¿¡æ¯`
   - `å†…è¡¬/è¡¬å«ä¿¡æ¯.å†…è¡¬-æˆåˆ†ç»„æˆ`
   
4. **å®éªŒä¿¡æ¯**ï¼ˆJSONæ ¼å¼ï¼‰
   - `ä½“å¤–å®éªŒ-å†…è¡¬ä¸çƒå¤´æ‘©æ“¦è…èš€å®éªŒ.*`
   - `ä½“å†…å®éªŒ-é«‹/è†å…³èŠ‚ç½®æ¢æœ¯.*`
   - `ä¸´åºŠæ•°æ®-æœ¯åéšè®¿.*`

---

## æ•°æ®å¯¼å…¥

### æ–¹æ³•1: ä½¿ç”¨èœå•ï¼ˆæ¨èï¼‰

```bash
python menu.py
# é€‰æ‹©ï¼š6 - å¿«é€Ÿï¼šæ‰¹é‡å¯¼å…¥JSONåˆ°æ•°æ®åº“
```

### æ–¹æ³•2: ä½¿ç”¨æ•°æ®åº“è„šæœ¬

```bash
python scripts/database.py
# é€‰æ‹©ï¼š1 - æ‰¹é‡å¯¼å…¥JSONæ–‡ä»¶
```

### å¯¼å…¥æµç¨‹

1. **æ‰«æç›®å½•**: æ‰«æ `data/processed/extracted/` ä¸‹çš„æ‰€æœ‰JSONæ–‡ä»¶
2. **éªŒè¯æ ¼å¼**: æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®
3. **å»é‡å¤„ç†**: åŸºäº `dataid` å­—æ®µè‡ªåŠ¨å»é‡
4. **æ‰¹é‡æ’å…¥**: æ‰¹é‡å†™å…¥æ•°æ®åº“
5. **ç»Ÿè®¡æŠ¥å‘Š**: æ˜¾ç¤ºå¯¼å…¥æˆåŠŸ/å¤±è´¥æ•°é‡

### å¯¼å…¥ç¤ºä¾‹

```
å¼€å§‹æ‰«æç›®å½•...
  æ‰¾åˆ° 15 ä¸ªJSONæ–‡ä»¶

å¼€å§‹å¯¼å…¥...
  [1/15] paper_1.json - æˆåŠŸå¯¼å…¥ 3 æ¡è®°å½•
  [2/15] paper_2.json - æˆåŠŸå¯¼å…¥ 5 æ¡è®°å½•
  [3/15] paper_3.json - è·³è¿‡ 2 æ¡é‡å¤è®°å½•
  ...

å¯¼å…¥å®Œæˆï¼
  æ€»æ–‡ä»¶æ•°: 15
  æ€»è®°å½•æ•°: 45
  æˆåŠŸ: 42
  é‡å¤è·³è¿‡: 3
```

---

## æ•°æ®å¯¼å‡º

### å¯¼å‡ºCSVæ ¼å¼

#### å•è¡¨CSV

```bash
python menu.py
# é€‰æ‹©ï¼š7 - å¿«é€Ÿï¼šå¯¼å‡ºæ‰€æœ‰CSVæ ¼å¼
```

è¾“å‡ºæ–‡ä»¶ï¼š
- `data/exports/artificial_joint_materials.csv`
- åŒ…å«æ‰€æœ‰å­—æ®µ
- JSONå­—æ®µä»¥å­—ç¬¦ä¸²å½¢å¼ä¿å­˜

#### å¤šè¡¨CSV

å¯ä»¥æŒ‰éœ€æ±‚æ‹†åˆ†å¯¼å‡ºï¼š

```python
from src.database import DatabaseManager

db = DatabaseManager()

# å¯¼å‡ºåŸºæœ¬ä¿¡æ¯
db.export_basic_info_csv("data/exports/basic_info.csv")

# å¯¼å‡ºçƒå¤´ä¿¡æ¯
db.export_ball_info_csv("data/exports/ball_info.csv")

# å¯¼å‡ºå®éªŒæ•°æ®
db.export_experiment_csv("data/exports/experiments.csv")
```

### å¯¼å‡ºExcelæ ¼å¼

```bash
python menu.py
# é€‰æ‹©ï¼š9 - å¿«é€Ÿï¼šå¯¼å‡ºExcelå¤šè¡¨
```

è¾“å‡ºæ–‡ä»¶ï¼š`data/exports/artificial_joint_materials_YYYYMMDD_HHMMSS.xlsx`

**å¤šå·¥ä½œè¡¨ç»“æ„**ï¼š

1. **åŸºæœ¬ä¿¡æ¯** - å…ƒæ•°æ®å’Œåº”ç”¨ä¿¡æ¯
2. **çƒå¤´åŸºæœ¬ä¿¡æ¯** - çƒå¤´ææ–™ã€å°ºå¯¸ç­‰
3. **çƒå¤´æˆåˆ†** - åŒ–å­¦æˆåˆ†è¯¦æƒ…
4. **çƒå¤´è¡¨é¢å¤„ç†** - è¡¨é¢å¤„ç†æ–¹æ³•
5. **å†…è¡¬åŸºæœ¬ä¿¡æ¯** - å†…è¡¬ææ–™ä¿¡æ¯
6. **å†…è¡¬æˆåˆ†** - å†…è¡¬åŒ–å­¦æˆåˆ†
7. **å®éªŒè®¾ç½®** - æ‘©æ“¦ç£¨æŸå®éªŒå‚æ•°
8. **å®éªŒç»“æœ** - æ‘©æ“¦ç£¨æŸç»“æœ
9. **ä½“å†…å®éªŒ** - åŠ¨ç‰©å®éªŒæ•°æ®
10. **ä¸´åºŠæ•°æ®** - ä¸´åºŠéšè®¿æ•°æ®

ä¼˜åŠ¿ï¼š
- âœ… ç»“æ„åŒ–æ¸…æ™°
- âœ… æ˜“äºåˆ†æ
- âœ… JSONè‡ªåŠ¨å±•å¹³
- âœ… ä¿ç•™æ‰€æœ‰ä¿¡æ¯

---

## æ•°æ®æŸ¥è¯¢

### ä½¿ç”¨æ•°æ®åº“è„šæœ¬æŸ¥è¯¢

```bash
python scripts/database.py
# é€‰æ‹©ï¼š3 - æŸ¥çœ‹æ•°æ®åº“ç»Ÿè®¡
```

### ç»Ÿè®¡ä¿¡æ¯ç¤ºä¾‹

```
æ•°æ®åº“ç»Ÿè®¡:
  æ€»è®°å½•æ•°: 127

åº”ç”¨éƒ¨ä½åˆ†å¸ƒ:
  é«‹å…³èŠ‚: 85 (66.9%)
  è†å…³èŠ‚: 42 (33.1%)

ææ–™ç±»å‹åˆ†å¸ƒ:
  CoCrMoåˆé‡‘: 56 (44.1%)
  UHMWPE: 38 (29.9%)
  é’›åˆé‡‘: 22 (17.3%)
  é™¶ç“·: 11 (8.7%)
```

### Python APIæŸ¥è¯¢

```python
from src.database import DatabaseManager

db = DatabaseManager()

# è·å–æ‰€æœ‰è®°å½•
records = db.get_all_records()

# æŒ‰åº”ç”¨éƒ¨ä½æŸ¥è¯¢
hip_records = db.query_by_application("é«‹å…³èŠ‚")

# æŒ‰dataidæŸ¥è¯¢
record = db.get_by_dataid("AJ_20251103_4026ca86")

# ç»Ÿè®¡æŸ¥è¯¢
stats = db.get_statistics()
```

### SQLæŸ¥è¯¢

ä½¿ç”¨SQLiteå®¢æˆ·ç«¯ç›´æ¥æŸ¥è¯¢ï¼š

```bash
sqlite3 data/artificial_joint.db
```

ç¤ºä¾‹æŸ¥è¯¢ï¼š

```sql
-- æŸ¥çœ‹æ‰€æœ‰è®°å½•
SELECT * FROM artificial_joint_materials LIMIT 10;

-- æŒ‰åº”ç”¨éƒ¨ä½ç»Ÿè®¡
SELECT åº”ç”¨éƒ¨ä½, COUNT(*) as count 
FROM artificial_joint_materials 
GROUP BY åº”ç”¨éƒ¨ä½;

-- æŸ¥æ‰¾ç‰¹å®šææ–™
SELECT dataid, æ•°æ®æ ‡è¯†, çƒå¤´ä¿¡æ¯.çƒå¤´åŸºæœ¬ä¿¡æ¯
FROM artificial_joint_materials
WHERE çƒå¤´ä¿¡æ¯.çƒå¤´åŸºæœ¬ä¿¡æ¯ LIKE '%CoCrMo%';
```

---

## æ•°æ®ç»´æŠ¤

### åˆ é™¤é‡å¤è®°å½•

```bash
python scripts/database.py
# é€‰æ‹©ï¼š4 - åˆ é™¤é‡å¤è®°å½•
```

ç³»ç»Ÿä¼šï¼š
1. æ£€æµ‹ç›¸åŒ `dataid` çš„è®°å½•
2. ä¿ç•™æœ€æ–°çš„ä¸€æ¡
3. åˆ é™¤å…¶ä½™é‡å¤è®°å½•
4. æŠ¥å‘Šåˆ é™¤æ•°é‡

### åˆ é™¤ç‰¹å®šè®°å½•

```python
from src.database import DatabaseManager

db = DatabaseManager()

# æŒ‰dataidåˆ é™¤
db.delete_by_dataid("AJ_20251103_4026ca86")

# æŒ‰æ¡ä»¶åˆ é™¤
db.delete_by_condition(åº”ç”¨éƒ¨ä½="æµ‹è¯•æ•°æ®")
```

### æ•°æ®å¤‡ä»½

å®šæœŸå¤‡ä»½æ•°æ®åº“æ–‡ä»¶ï¼š

```bash
# å¤‡ä»½
cp data/artificial_joint.db data/backups/artificial_joint_$(date +%Y%m%d).db

# æˆ–ä½¿ç”¨SQL dump
sqlite3 data/artificial_joint.db .dump > backup.sql
```

### æ•°æ®æ¢å¤

```bash
# ä»å¤‡ä»½æ¢å¤
cp data/backups/artificial_joint_20251103.db data/artificial_joint.db

# ä»SQLæ–‡ä»¶æ¢å¤
sqlite3 data/artificial_joint.db < backup.sql
```

### æ•°æ®åº“ä¼˜åŒ–

```bash
# å‹ç¼©æ•°æ®åº“ï¼ˆå‡å°æ–‡ä»¶å¤§å°ï¼‰
sqlite3 data/artificial_joint.db "VACUUM;"

# åˆ†æä¼˜åŒ–
sqlite3 data/artificial_joint.db "ANALYZE;"
```

---

## æ•°æ®å­—æ®µè¯´æ˜

### JSONå­—æ®µæ ¼å¼

æŸäº›å­—æ®µä»¥JSONå­—ç¬¦ä¸²å­˜å‚¨ï¼Œä¾¿äºå­˜å‚¨å¤æ‚ç»“æ„ï¼š

**çƒå¤´åŸºæœ¬ä¿¡æ¯ç¤ºä¾‹**ï¼š
```json
{
  "ææ–™ç±»åˆ«": "CoCrMoåˆé‡‘",
  "ç›´å¾„": "28 mm",
  "è¡¨é¢ç²—ç³™åº¦": "Ra < 0.05 Î¼m"
}
```

**æˆåˆ†ç»„æˆç¤ºä¾‹**ï¼š
```json
{
  "Co": "60.5 wt%",
  "Cr": "28.0 wt%",
  "Mo": "6.0 wt%"
}
```

**å®éªŒè®¾ç½®ç¤ºä¾‹**ï¼š
```json
{
  "è½½è·": "50 N",
  "é¢‘ç‡": "1 Hz",
  "æ¸©åº¦": "37Â°C",
  "æ¶¦æ»‘æ¶²": "å°ç‰›è¡€æ¸…"
}
```

### è§£æJSONå­—æ®µ

Pythonä¸­è§£æï¼š

```python
import json

record = db.get_by_dataid("AJ_20251103_4026ca86")
ball_info = json.loads(record['çƒå¤´ä¿¡æ¯.çƒå¤´åŸºæœ¬ä¿¡æ¯'])
print(ball_info['ææ–™ç±»åˆ«'])  # è¾“å‡º: CoCrMoåˆé‡‘
```

---

## æ•°æ®è´¨é‡æ§åˆ¶

### æ•°æ®éªŒè¯

å¯¼å…¥å‰éªŒè¯ï¼š
- âœ… dataid å”¯ä¸€æ€§
- âœ… JSON æ ¼å¼æ­£ç¡®æ€§
- âœ… å¿…å¡«å­—æ®µå®Œæ•´æ€§

### æ•°æ®ä¸€è‡´æ€§

å»ºè®®å®šæœŸæ£€æŸ¥ï¼š
1. é‡å¤è®°å½•
2. ç©ºå€¼æ¯”ä¾‹
3. å¼‚å¸¸å€¼æ£€æµ‹
4. æ ¼å¼ä¸€è‡´æ€§

---

## å¸¸è§é—®é¢˜

### Q: å¯¼å…¥æ—¶å‡ºç°é‡å¤è®°å½•ï¼Ÿ

ç³»ç»Ÿä¼šè‡ªåŠ¨è·³è¿‡ç›¸åŒ `dataid` çš„è®°å½•ã€‚å¦‚éœ€æ›´æ–°ï¼Œè¯·å…ˆåˆ é™¤æ—§è®°å½•ã€‚

### Q: JSONå­—æ®µå¦‚ä½•æŸ¥è¯¢ï¼Ÿ

SQLiteæ”¯æŒJSONå‡½æ•°ï¼ˆéœ€è¦3.38+ç‰ˆæœ¬ï¼‰ï¼š

```sql
SELECT json_extract("çƒå¤´ä¿¡æ¯.çƒå¤´åŸºæœ¬ä¿¡æ¯", '$.ææ–™ç±»åˆ«') 
FROM artificial_joint_materials;
```

### Q: å¦‚ä½•æ‰¹é‡æ›´æ–°æ•°æ®ï¼Ÿ

```python
db = DatabaseManager()
records = db.get_all_records()

for record in records:
    # æ›´æ–°é€»è¾‘
    record['æ–°å­—æ®µ'] = 'æ–°å€¼'
    db.update_record(record)
```

### Q: æ•°æ®åº“æ–‡ä»¶å¤ªå¤§æ€ä¹ˆåŠï¼Ÿ

1. å®šæœŸæ¸…ç†æµ‹è¯•æ•°æ®
2. è¿è¡Œ VACUUM å‹ç¼©
3. è€ƒè™‘å½’æ¡£å†å²æ•°æ®
4. å‡çº§åˆ° PostgreSQLï¼ˆå¦‚éœ€è¦ï¼‰

---

## æ•°æ®åº“è¿ç§»

### ä»SQLiteè¿ç§»åˆ°MySQL/PostgreSQL

1. å¯¼å‡ºCSVæ ¼å¼
2. ä½¿ç”¨ç›®æ ‡æ•°æ®åº“å¯¼å…¥å·¥å…·
3. è°ƒæ•´å­—æ®µç±»å‹
4. æ›´æ–°é…ç½®æ–‡ä»¶

ç¤ºä¾‹ï¼ˆPostgreSQLï¼‰ï¼š

```bash
# å¯¼å‡ºCSV
python scripts/database.py

# åˆ›å»ºè¡¨
psql -d mydb -f schema.sql

# å¯¼å…¥æ•°æ®
\copy artificial_joint_materials FROM 'data.csv' CSV HEADER;
```

---

## æœ€ä½³å®è·µ

1. **å®šæœŸå¤‡ä»½**: æ¯å‘¨å¤‡ä»½æ•°æ®åº“æ–‡ä»¶
2. **éªŒè¯æ•°æ®**: å¯¼å…¥åæ£€æŸ¥ç»Ÿè®¡ä¿¡æ¯
3. **ç‰ˆæœ¬æ§åˆ¶**: ä¿ç•™é‡è¦ç‰ˆæœ¬çš„å¤‡ä»½
4. **æ–‡æ¡£è®°å½•**: è®°å½•æ•°æ®æºå’Œæ›´æ–°æ—¥å¿—
5. **æƒé™ç®¡ç†**: é™åˆ¶æ•°æ®åº“æ–‡ä»¶è®¿é—®æƒé™
