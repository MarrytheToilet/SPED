# Prompt改进说明

## 改进时间
2026-01-17

## 改进目标
解决提取结果中大量"未提及"、空字符串等不规范空值的问题。

## 主要改进内容

### 1. 添加了"核心原则"部分 ⭐

**位置**: 文档开头

**内容**:
- 黄金规则：宁缺毋滥
- 什么时候留空（null）
- 什么时候提取
- 强调"只提取明确信息"原则

**效果**: 让模型在提取前就明确理解"不确定就留空"的原则

### 2. 大幅扩展"空值处理"规则 ⭐⭐⭐

**改进前**:
```
### 5. 空值处理
- 整个表无数据: `null`
- 字段无值: `null`
- ❌ 不使用 `""`, `"未提及"`, `"无"`
```

**改进后**:
- 字段级空值详细说明
- 表级空值详细说明
- 常见字段的空值判断表
- 明确列出禁止使用的值

**示例对比表**:
| 字段 | 留空（null）的情况 | 可以提取的情况 |
|------|-------------------|---------------|
| 尺寸类 | "厚度约6mm左右" | "厚度6.3 mm"、"厚度6±0.2 mm" |
| 硬度类 | "硬度较高" | "硬度450 HV"、"硬度>400 HV" |

### 3. 添加了"反面教材"部分 ⭐⭐

**位置**: 文档末尾

**包含8个常见错误示例**:
1. 使用错误的空值标记
2. 提取模糊或概括性描述
3. 提取范围值（非实验数据）
4. 缺少单位或单位错误
5. 材料名称不规范
6. 推测或补全数据
7. 综述论文处理不当
8. 不该提取的内容

**每个示例包含**:
- ❌ 错误做法
- ✅ 正确做法
- 📝 详细解释

### 4. 增强了"提取检查清单" ⭐

**改进**:
- 分为6个步骤
- 每步都有具体的检查项
- 添加了常见错误自查表

**新增检查项**:
- 禁止值检查
- 模糊描述检查
- 不确定数据检查

### 5. 强调了"提取流程建议"

**5步流程**:
1. 第一遍阅读：确定论文类型
2. 第二遍阅读：标记明确信息
3. 开始提取：创建ID，填充数据
4. 检查清单：逐项核对
5. 最终review：确保没有错误值

## 关键改进点对比

| 改进项 | 改进前 | 改进后 |
|--------|--------|--------|
| 空值说明 | 简单3行 | 详细3个表格+示例 |
| 错误示例 | 无 | 8个详细示例 |
| 检查清单 | 简单列表 | 6步骤+错误自查表 |
| 核心原则 | 散布各处 | 集中在开头强调 |
| 流程指导 | 无 | 5步详细流程 |

## 预期效果

### 短期效果（立即）
1. **减少空值错误**: "未提及"、""、"无"等错误大幅减少
2. **提高数据质量**: 只提取明确信息，不再推测补全
3. **格式更统一**: 所有空值统一使用 `null`

### 中期效果（经过几次提取后）
1. **模型学习**: LLM会学习到正确的提取模式
2. **更少干预**: 需要人工修正的地方减少
3. **一致性提升**: 不同论文的提取格式更一致

### 长期效果（数据积累后）
1. **数据可用性**: 数据库中的数据更可靠
2. **分析准确性**: 基于数据的分析更准确
3. **系统稳定性**: 整个pipeline更稳定

## 使用建议

### 1. 立即应用
```bash
# 新的提取将自动使用改进后的prompt
python menu.py
# 选择 3 - 批量提取
```

### 2. 测试改进效果
```bash
# 测试单个文件
python scripts/extract.py single
# 选择一个之前提取效果不好的文件
# 对比新旧结果
```

### 3. 监控改进效果

**检查指标**:
- 空值是否都是 `null`
- 是否还有"未提及"等错误值
- 模糊描述是否被正确留空
- 单位是否完整

**检查命令**:
```bash
# 检查是否还有错误的空值标记
grep -r "未提及\|不清楚\|无\|N/A" data/processed/extracted/
```

### 4. 持续优化

**如果还发现问题**:
1. 记录具体的错误case
2. 在prompt中添加对应的错误示例
3. 更新检查清单

## 技术细节

### Prompt长度
- 改进前：~705行
- 改进后：~1029行
- 增加：~324行（+46%）

### 结构优化
```
开头: 核心原则（强调）
    ↓
中间: 详细规则（展开）
    ↓
示例: ICL示例（学习）
    ↓
结尾: 反面教材+检查清单（验证）
```

### ICL学习策略
1. **正面示例**: 展示正确做法
2. **反面示例**: 展示错误做法
3. **对比学习**: 错误vs正确
4. **检查清单**: 自我验证

## 备份信息

**备份位置**: `prompts/prompt_backup_20260117_*.md`

**恢复命令**:
```bash
# 如果需要恢复旧版本
cp prompts/prompt_backup_20260117_*.md prompts/prompt.md
```

## 后续计划

### 近期（1-2周）
1. 监控提取效果
2. 收集问题案例
3. 持续微调prompt

### 中期（1个月）
1. 根据实际效果调整规则
2. 添加更多领域特定的示例
3. 优化ICL示例

### 长期（3个月）
1. 建立prompt版本管理
2. A/B测试不同prompt策略
3. 自动化prompt优化

## 注意事项

### ⚠️ 重要提醒
1. **首次使用**: 建议先测试几个文件，验证效果
2. **批量应用**: 确认效果后再批量提取
3. **保留备份**: 已自动备份旧版本prompt
4. **监控质量**: 定期检查提取结果质量

### 💡 使用技巧
1. 使用 `--model` 参数测试不同模型效果
2. 对比同一文件的新旧提取结果
3. 重点关注之前容易出错的字段
4. 记录改进效果，便于持续优化

## 总结

这次改进的核心是：**宁缺毋滥，只提取明确信息**

通过：
1. ✅ 在开头强调核心原则
2. ✅ 详细展开空值处理规则
3. ✅ 添加大量反面教材
4. ✅ 提供详细的检查清单
5. ✅ 给出具体的提取流程

让LLM更清楚地知道：
- 什么应该提取
- 什么不应该提取
- 不确定的怎么处理
- 如何自我检查

预期大幅减少"未提及"等不规范空值，提高数据质量！
